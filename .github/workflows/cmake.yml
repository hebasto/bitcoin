# Copyright (c) 2023-present The Bitcoin Core developers
# Distributed under the MIT software license, see the accompanying
# file COPYING or https://opensource.org/license/mit/.

name: CMake
on:
  # Running for pushes is enough in the cmake-staging branch.
  # pull_request:
  push:
    branches:
      - '**'
    tags-ignore:
      - '**'

concurrency:
  group: ${{ github.workflow }}${{ github.event_name != 'pull_request' && github.run_id || github.ref }}
  cancel-in-progress: true

jobs:
  solaris:
    name: 'OmniOS, no depends, sqlite only, no gui'
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - uses: vmactions/omnios-vm@v1
      with:
        # cmake version 3.29.2
        prepare: |
          pkg install cmake clang-18
        run: |
          uname -a
          make -C depends NO_QT=1 NO_WALLET=1 NO_UPNP=1 NO_NATPMP=1 NO_ZMQ=1 NO_USDT=1
          cmake -B build
        copyback: false
